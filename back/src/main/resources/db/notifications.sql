-- 알림 테이블 생성
DROP TABLE NOTIFICATIONS;

CREATE TABLE NOTIFICATIONS (
                               ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                               USER_ID VARCHAR2(50) NOT NULL,
                               NOTIFICATION_TYPE VARCHAR2(50) NOT NULL, -- 'RESERVATION_CONFIRMED', 'REMINDER_24H', 'REMINDER_1H', etc.
                               TITLE VARCHAR2(200) NOT NULL,
                               MESSAGE CLOB NOT NULL,
                               RESERVATION_ID NUMBER, -- 예약 관련 알림인 경우 참조
                               IS_READ NUMBER(1) DEFAULT 0 NOT NULL, -- 0: 읽지않음, 1: 읽음
                               CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
                               SCHEDULED_AT TIMESTAMP, -- 스케줄 알림인 경우 발송 예정 시간
                               SENT_AT TIMESTAMP, -- 실제 발송된 시간
                               CONSTRAINT FK_NOTIFICATION_USER FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
                               CONSTRAINT FK_NOTIFICATION_RESERVATION FOREIGN KEY (RESERVATION_ID) REFERENCES RESERVATION(ID)
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IDX_NOTIFICATIONS_USER_ID ON NOTIFICATIONS(USER_ID);
CREATE INDEX IDX_NOTIFICATIONS_TYPE ON NOTIFICATIONS(NOTIFICATION_TYPE);
CREATE INDEX IDX_NOTIFICATIONS_SCHEDULED ON NOTIFICATIONS(SCHEDULED_AT);
CREATE INDEX IDX_NOTIFICATIONS_UNREAD ON NOTIFICATIONS(USER_ID, IS_READ);