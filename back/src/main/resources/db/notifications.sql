-- 알림 테이블 생성
DROP TABLE NOTIFICATIONS;

CREATE TABLE NOTIFICATIONS (
                               ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                               USER_ID VARCHAR2(50) NOT NULL,
                               NOTIFICATION_TYPE VARCHAR2(50) NOT NULL, -- 'RESERVATION_CONFIRMED', 'REMINDER_24H', 'REMINDER_1H', etc.
                               TITLE VARCHAR2(200) NOT NULL,
                               MESSAGE CLOB NOT NULL,
                               RESERVATION_ID NUMBER, -- 예약 관련 알림인 경우 참조
                               IS_READ NUMBER(1) DEFAULT 0 NOT NULL, -- 0: 읽지않음, 1: 읽음
                               CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
                               SCHEDULED_AT TIMESTAMP, -- 스케줄 알림인 경우 발송 예정 시간
                               SENT_AT TIMESTAMP, -- 실제 발송된 시간
                               CONSTRAINT FK_NOTIFICATION_USER FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
                               CONSTRAINT FK_NOTIFICATION_RESERVATION FOREIGN KEY (RESERVATION_ID) REFERENCES RESERVATION(ID)
);

-- 인덱스 생성 (성능 최적화)
CREATE INDEX IDX_NOTIFICATIONS_USER_ID ON NOTIFICATIONS(USER_ID);
CREATE INDEX IDX_NOTIFICATIONS_TYPE ON NOTIFICATIONS(NOTIFICATION_TYPE);
CREATE INDEX IDX_NOTIFICATIONS_SCHEDULED ON NOTIFICATIONS(SCHEDULED_AT);
CREATE INDEX IDX_NOTIFICATIONS_UNREAD ON NOTIFICATIONS(USER_ID, IS_READ);

-- 알림 더미 데이터 삽입
-- 기존 데이터 정리 (필요시)
DELETE FROM NOTIFICATIONS;

-- ===== kko 계정 알림 (5개) =====
INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('kko', 'RESERVATION_CONFIRMED', '예약이 확정되었습니다!', '2025년 9월 5일 람보르기니 우라칸 예약이 성공적으로 완료되었습니다. 예약번호: RES-2025-001', 35, 0, TIMESTAMP '2025-09-03 10:30:00', TIMESTAMP '2025-09-03 10:30:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('kko', 'REMINDER_24H', '24시간 후 차량 대여 예정', '내일 오전 10시에 포시즌스 호텔 서울에서 차량 인수 예정입니다. 운전면허증과 신분증을 준비해주세요.', 35, 1, TIMESTAMP '2025-09-02 15:20:00', TIMESTAMP '2025-09-02 15:20:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('kko', 'PAYMENT_COMPLETED', '결제가 완료되었습니다', '차량 대여료 350,000원 결제가 성공적으로 처리되었습니다. 카카오페이로 결제되었습니다.', 35, 1, TIMESTAMP '2025-09-02 14:45:00', TIMESTAMP '2025-09-02 14:45:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('kko', 'LICENSE_APPROVED', '면허증 승인 완료', '제출해주신 운전면허증이 승인되었습니다. 이제 모든 차량을 자유롭게 예약하실 수 있습니다.', NULL, 0, TIMESTAMP '2025-09-01 11:15:00', TIMESTAMP '2025-09-01 11:15:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('kko', 'REMINDER_1H', '1시간 후 차량 반납 예정', '오후 6시에 차량 반납 예정입니다. 연료를 가득 채우고 차량 상태를 확인해주세요.', 35, 0, TIMESTAMP '2025-09-03 17:00:00', TIMESTAMP '2025-09-03 17:00:00');

-- ===== ksy 계정 알림 (4개) =====
INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('ksy', 'RESERVATION_CONFIRMED', '예약이 확정되었습니다!', '2025년 9월 7일 포르쉐 911 예약이 성공적으로 완료되었습니다. 예약번호: RES-2025-002', 26, 1, TIMESTAMP '2025-09-02 16:20:00', TIMESTAMP '2025-09-02 16:20:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('ksy', 'PAYMENT_COMPLETED', '결제가 완료되었습니다', '차량 대여료 280,000원 결제가 성공적으로 처리되었습니다. 신용카드로 결제되었습니다.', 26, 1, TIMESTAMP '2025-09-02 16:25:00', TIMESTAMP '2025-09-02 16:25:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('ksy', 'REMINDER_24H', '24시간 후 차량 대여 예정', '내일 오후 2시에 신라호텔에서 차량 인수 예정입니다. 운전면허증과 신분증을 준비해주세요.', 26, 0, TIMESTAMP '2025-09-03 14:00:00', TIMESTAMP '2025-09-03 14:00:00');

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SENT_AT) VALUES
    ('ksy', 'LICENSE_APPROVED', '면허증 승인 완료', '제출해주신 운전면허증이 승인되었습니다. 이제 프리미엄 차량도 예약 가능합니다.', NULL, 0, TIMESTAMP '2025-08-30 09:30:00', TIMESTAMP '2025-08-30 09:30:00');

-- 스케줄된 알림 (미래 발송 예정) 몇 개 추가
INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SCHEDULED_AT, SENT_AT) VALUES
    ('kko', 'RETURN_REMINDER', '차량 반납 시간이 다가옵니다', '1시간 후 차량 반납 예정입니다. 반납 준비를 해주세요.', 35, 0, TIMESTAMP '2025-09-03 12:00:00', TIMESTAMP '2025-09-05 17:00:00', NULL);

INSERT INTO NOTIFICATIONS (USER_ID, NOTIFICATION_TYPE, TITLE, MESSAGE, RESERVATION_ID, IS_READ, CREATED_AT, SCHEDULED_AT, SENT_AT) VALUES
    ('ksy', 'REMINDER_1H', '1시간 후 차량 대여 예정', '곧 차량 인수 시간입니다. 신라호텔로 이동해주세요.', 26, 0, TIMESTAMP '2025-09-03 12:00:00', TIMESTAMP '2025-09-06 13:00:00', NULL);

-- 데이터 삽입 확인
COMMIT;

-- 결과 확인 쿼리
SELECT USER_ID, NOTIFICATION_TYPE, TITLE, IS_READ, CREATED_AT
FROM NOTIFICATIONS
ORDER BY USER_ID, CREATED_AT DESC;